{% extends "base.html" %}

{% block title %}Verify Email - Dayflow{% endblock %}

{% block content %}
<section class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <!-- Header -->
        <div class="text-center">
            <div class="mx-auto h-16 w-16 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-full flex items-center justify-center mb-6 animate-pulse">
                <i class="fas fa-envelope-open-text text-2xl text-white"></i>
            </div>
            <h2 class="text-3xl font-bold text-white mb-2">Verify Your Email</h2>
            <p class="text-gray-400">Enter the OTP sent to your email address</p>
            <p class="text-blue-400 text-sm mt-2">{{ user_email }}</p>
        </div>

        <!-- Progress Indicator -->
        <div class="flex items-center justify-center space-x-2 mb-8">
            <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center">
                    <i class="fas fa-check text-white text-sm"></i>
                </div>
                <span class="text-green-400 text-xs ml-2">Login</span>
            </div>
            <div class="w-12 h-0.5 bg-yellow-500"></div>
            <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center animate-pulse">
                    <i class="fas fa-envelope text-white text-sm"></i>
                </div>
                <span class="text-yellow-400 text-xs ml-2">Verify Email</span>
            </div>
            <div class="w-12 h-0.5 bg-gray-600"></div>
            <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center">
                    <i class="fas fa-lock text-white text-sm"></i>
                </div>
                <span class="text-gray-500 text-xs ml-2">Set Password</span>
            </div>
        </div>

        <!-- OTP Form -->
        <div class="bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl rounded-2xl shadow-2xl p-8 border border-white/10 glass-highlight">
            <form method="POST" action="{{ url_for('verify_otp') }}" class="space-y-6">
                <!-- Info Notice -->
                <div class="bg-blue-500/10 border border-blue-500/30 backdrop-blur-xl rounded-xl p-4">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle text-blue-400 mt-1 mr-3"></i>
                        <div class="text-sm text-blue-300">
                            <p class="font-semibold mb-1">Check your email</p>
                            <p>We've sent a 6-digit verification code to your email address. The code expires in 10 minutes.</p>
                        </div>
                    </div>
                </div>

                <!-- OTP Input -->
                <div>
                    <label for="otp" class="block text-sm font-medium text-gray-300 mb-2">
                        <i class="fas fa-key mr-2"></i>Verification Code
                    </label>
                    <input 
                        type="text" 
                        id="otp" 
                        name="otp" 
                        maxlength="6"
                        pattern="[0-9]{6}"
                        class="w-full px-4 py-3 bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500/60 focus:border-primary-500/40 transition glass-highlight text-center text-2xl font-bold tracking-widest" 
                        placeholder="000000"
                        required
                        autofocus
                        autocomplete="off">
                    <p class="text-xs text-gray-500 mt-2">Enter the 6-digit code from your email</p>
                </div>

                <!-- Submit Button -->
                <button type="submit" 
                    class="w-full py-3 text-lg text-white font-semibold rounded-xl btn-liquid glass-highlight focus:outline-none focus:ring-2 focus:ring-white/30 transform hover:scale-[1.02] transition-all duration-200">
                    <i class="fas fa-check-circle mr-2"></i>
                    Verify Email
                </button>
            </form>

            <!-- Resend OTP -->
            <div class="mt-6 text-center">
                <p class="text-gray-400 text-sm mb-2">Didn't receive the code?</p>
                <form method="POST" action="{{ url_for('resend_otp') }}" class="inline">
                    <button type="submit"
                        id="resend-btn"
                        class="text-blue-400 hover:text-blue-300 font-medium transition-colors">
                        <i class="fas fa-redo mr-1"></i>Resend OTP
                    </button>
                </form>
                <p id="resend-timer" class="text-gray-500 text-xs mt-2 hidden">
                    Please wait <span id="countdown">60</span> seconds before requesting again
                </p>
            </div>

            <!-- Help Text -->
            <div class="mt-6 pt-6 border-t border-white/10 text-center">
                <p class="text-gray-400 text-sm">
                    <i class="fas fa-question-circle mr-1"></i>
                    Having trouble? Contact your administrator
                </p>
            </div>
        </div>

        <!-- Logout Link -->
        <div class="text-center">
            <a href="{{ url_for('logout') }}" 
               class="inline-flex items-center text-gray-400 hover:text-white">
                <i class="fas fa-sign-out-alt mr-2"></i>
                Logout
            </a>
        </div>
    </div>
</section>

<script>
// Auto-format OTP input
const otpInput = document.getElementById('otp');
otpInput.addEventListener('input', function(e) {
    // Only allow numbers
    this.value = this.value.replace(/[^0-9]/g, '');
});

// Resend cooldown timer
let cooldownActive = false;
let countdown = 60;

document.querySelector('form[action="{{ url_for('resend_otp') }}"]').addEventListener('submit', function(e) {
    if (cooldownActive) {
        e.preventDefault();
        return;
    }
    
    cooldownActive = true;
    const resendBtn = document.getElementById('resend-btn');
    const resendTimer = document.getElementById('resend-timer');
    const countdownSpan = document.getElementById('countdown');
    
    resendBtn.disabled = true;
    resendBtn.classList.add('opacity-50', 'cursor-not-allowed');
    resendTimer.classList.remove('hidden');
    
    countdown = 60;
    const interval = setInterval(() => {
        countdown--;
        countdownSpan.textContent = countdown;
        
        if (countdown <= 0) {
            clearInterval(interval);
            resendBtn.disabled = false;
            resendBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            resendTimer.classList.add('hidden');
            cooldownActive = false;
        }
    }, 1000);
});

// Add form animation on submit
document.querySelector('form[action="{{ url_for('verify_otp') }}"]').addEventListener('submit', function(e) {
    const button = this.querySelector('button[type="submit"]');
    button.innerHTML = '<i class="fas fa-spinner animate-spin mr-2"></i>Verifying...';
    button.disabled = true;
});
</script>
{% endblock %}
